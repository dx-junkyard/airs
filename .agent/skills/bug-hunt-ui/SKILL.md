---
name: bug-hunt-ui
description: Playwright MCPでブラウザを操作し、UIベースでバグを発見してGitHub Issueとして起票するエージェント。「UIバグ探し」「画面テスト」「UI bug hunt」「ブラウザでバグ探し」時に使用。
---

# UIバグ発見エージェント（Playwright MCP）

Playwright MCPを使ってブラウザ上で実際にアプリケーションを操作し、UIベースでバグを発見してGitHub Issueとして起票する。

## 入力パラメータ

ユーザーから以下の情報を受け取る（未指定の場合はデフォルト値を使用）:

| パラメータ | デフォルト | 例 |
|-----------|-----------|-----|
| 対象画面 | 全画面 | `dashboard`, `report`, `map`, `help`, `staff` |
| 目標件数 | 10件 | `5`, `20` |
| ベースURL | `http://localhost:3000` | `https://staging.example.com` |
| ビューポート | desktop + mobile | `desktop`, `mobile`, `both` |

## 前提条件

- 開発サーバーが起動していること（`pnpm run dev` or `pnpm run start`）
- Playwright MCP が利用可能であること

起動確認:
```bash
lsof -i :3000
```
起動していなければユーザーに通知する。

## 画面一覧とテストルート

| 画面 | パス | 認証 |
|------|------|------|
| ダッシュボード | `/` (admin: `/admin/report`) | - |
| 通報一覧（リスト） | `/admin/report` | admin |
| 通報一覧（地図） | `/admin/report?view=map` | admin |
| 通報詳細 | `/admin/report/{id}` | admin |
| 通報新規作成 | `/admin/report/new` | admin |
| 職員一覧 | `/admin/staff` | admin |
| 職員詳細 | `/admin/staff/{id}` | admin |
| 職員新規作成 | `/admin/staff/new` | admin |
| システム設定 | `/admin/settings` | admin |
| 管理者ヘルプ | `/admin/help` | admin |
| 地図 | `/map` | - |
| ユーザー向け通報 | `/report` | - |
| ユーザー向けヘルプ | `/help` | - |
| AI獣害通報 | `/ai-report` | - |

## 実行フロー

### Step 1: 開発サーバー確認

```bash
lsof -i :3000
```

起動していない場合はユーザーに `pnpm run dev` の実行を促す。

### Step 2: ブラウザ初期化

Playwright MCPでブラウザを起動し、ベースURLに移動する。

```
browser_navigate → {ベースURL}
browser_take_screenshot → 初期状態を確認
```

### Step 3: 画面ごとの探索

各画面について以下のテストシナリオを実行する。
1画面につき以下の観点で確認し、スクリーンショットを撮影して問題を記録する。

#### 3-A: デスクトップ表示チェック（1280x800）

```
browser_resize → width: 1280, height: 800
```

各画面に遷移して以下を確認:

**レイアウト・表示**:
- ページが正常にレンダリングされるか（白画面、エラー表示がないか）
- レイアウト崩れがないか（要素の重なり、はみ出し）
- テキストの切れ、文字化け
- 画像の表示（broken image）
- ローディング状態が解消されるか

**ナビゲーション**:
- サイドバーのリンクが全て動作するか
- パンくずリストの表示と遷移
- 戻るボタン/リンクの動作

**データ表示**:
- テーブルやリストにデータが表示されるか
- 件数表示とデータの整合性
- ソート・フィルターの動作
- ページネーションの動作

**フォーム**:
- 入力フィールドの動作
- バリデーションメッセージの表示
- 送信ボタンの状態（disabled/enabled）
- 必須項目の表示

#### 3-B: モバイル表示チェック（375x812）

```
browser_resize → width: 375, height: 812
```

**レスポンシブ固有**:
- ハンバーガーメニューの動作
- テーブルの横スクロール
- ボタン・入力フィールドのタップ領域
- モーダル/ダイアログの表示
- フォントサイズの可読性

#### 3-C: インタラクションテスト

**クリック操作**:
```
browser_click → 各ボタン・リンクをクリック
browser_take_screenshot → 結果を確認
```

**フォーム入力**:
```
browser_fill_form → テストデータを入力
browser_take_screenshot → バリデーション結果を確認
```

**境界値テスト（URL操作）**:
```
browser_navigate → ?page=0
browser_navigate → ?page=9999
browser_navigate → ?zoom=-1
browser_navigate → ?q=<script>alert(1)</script>
```

**空状態テスト**:
- フィルターで結果0件にする
- 空のフォームを送信
- 検索結果なしの表示

#### 3-D: コンソールエラーチェック

各画面遷移後にブラウザコンソールを確認:
```
browser_console_messages → エラー・警告を収集
```

チェック対象:
- JavaScript エラー（TypeError, ReferenceError等）
- React エラー（Hydration mismatch, Invalid hook call等）
- ネットワークエラー（404, 500）
- Rechartsの警告（negative width/height）
- Next.js の警告

### Step 4: バグの記録と分類

発見した各バグについて以下を記録:

```
### バグ {N}
- **画面**: {画面名} ({パス})
- **ビューポート**: desktop / mobile / both
- **種類**: 表示崩れ / 機能不具合 / コンソールエラー / レスポンシブ / アクセシビリティ
- **概要**: 1行要約
- **再現手順**:
  1. {パス}にアクセス
  2. {操作}
  3. {結果}
- **スクリーンショット**: （撮影したスクリーンショットの内容を文章で説明）
- **期待される動作**: {期待}
- **実際の動作**: {実際}
```

### Step 5: GitHub Issue起票

各バグについて Issue を作成する。

```bash
gh issue create --title "{タイトル}" --label "bug" --body "$(cat <<'EOF'
## 概要
{1行要約}

## 環境
- ビューポート: {デスクトップ/モバイル/両方}
- ブラウザ: Chromium (Playwright)
- URL: {該当パス}

## 再現手順
1. {ベースURL}{パス} にアクセス
2. {操作}
3. {結果が観察される}

## 期待される動作
{期待}

## 実際の動作
{実際}

## スクリーンショット
{スクリーンショットの内容説明}

## コンソールエラー（該当する場合）
```
{エラーメッセージ}
```

## 補足
{追加情報}
EOF
)"
```

### Step 6: 優先度ラベル付与

| ラベル | 条件 |
|--------|------|
| `priority: critical` | ページが表示されない、データ消失、セキュリティ問題 |
| `priority: high` | 主要機能が動作しない、データ不整合が目に見える |
| `priority: medium` | レイアウト崩れ、モバイル表示の問題、コンソール警告 |
| `priority: low` | 軽微な表示の不統一、非機能的な問題 |

```bash
gh issue edit {番号} --add-label "priority: {レベル}"
```

### Step 7: サマリー報告

```
## UIバグ探索結果

### テスト範囲
- 画面数: {N}画面
- ビューポート: デスクトップ (1280x800) + モバイル (375x812)
- ベースURL: {URL}

### 発見バグ一覧
| # | Issue | 優先度 | 画面 | VP | 種類 | 概要 |
|---|-------|--------|------|-----|------|------|
| 1 | #XXX  | P1     | 通報一覧 | mobile | 表示崩れ | ... |
| 2 | #YYY  | P2     | ダッシュボード | desktop | コンソールエラー | ... |

### 正常だった画面
- {画面名}: デスクトップ・モバイルともに問題なし
```

## 画面別テストシナリオ詳細

### ダッシュボード (`/admin/report` ルートページ)
1. 統計カードの表示（件数が0でないか）
2. チャートのレンダリング（空白にならないか）
3. エリアランキングの表示
4. 最近の通報グループカードの表示とリンク
5. 日付フィルターの切り替え

### 通報一覧 (`/admin/report`)
1. リスト表示 → 地図表示の切り替え
2. ステータスフィルター（各ステータスで絞り込み）
3. 獣種フィルター
4. キーワード検索（入力 → 結果表示）
5. ページネーション（1ページ目 → 2ページ目 → 最終ページ）
6. 詳細フィルター展開 → 日付範囲設定
7. 新規作成ボタンの遷移

### 通報詳細 (`/admin/report/{id}`)
1. 詳細情報の表示（獣種、住所、ステータス等）
2. 画像カルーセルの動作
3. 編集モード切り替え → 各フィールドの入力 → キャンセル
4. ステータス変更ボタンの動作
5. 担当者割り当て
6. 地図上のマーカー表示

### 地図 (`/map`)
1. 地図のレンダリング
2. マーカーの表示
3. マーカークリック → ポップアップ表示
4. レイヤーパネルの開閉
5. フィルター切り替え

### 職員管理 (`/admin/staff`)
1. 職員一覧の表示
2. 職員詳細への遷移
3. 新規作成フォーム

### ヘルプ (`/admin/help`, `/help`)
1. FAQのアコーディオン展開/折りたたみ
2. リンク先の遷移
3. 全セクションの表示確認
