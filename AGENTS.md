# AIRS - é‡ç”Ÿå‹•ç‰©ç›®æ’ƒé€šå ±AIç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚¬ã‚¤ãƒ‰

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

é‡ç”Ÿå‹•ç‰©ï¼ˆã‚µãƒ«ã€ã‚·ã‚«ã€ã‚¤ãƒã‚·ã‚·ã€ã‚¯ãƒãªã©ï¼‰ã®ç›®æ’ƒãƒ»é€šå ±ã‚’AIã§åŠ¹ç‡çš„ã«ç®¡ç†ã™ã‚‹çµ±åˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€‚LINEã‹ã‚‰ã®é€šå ±ã«å¯¾å¿œã—ã€DDDï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆï¼‰ã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åŸºã¥ã„ãŸNext.js 16ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚æ”¿åºœãƒ‡ã‚¸ã‚¿ãƒ«åºã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã‚’æ¡ç”¨ã—ã€ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ã‚³ã‚¢æŠ€è¡“

- **Next.js 16** - App Routerã€Server Actionsã€React 19
- **TypeScript 5** - å‹å®‰å…¨æ€§
- **TanStack Query v5** - ãƒ‡ãƒ¼ã‚¿åŒæœŸã¨ã‚µãƒ¼ãƒãƒ¼ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
- **Vercel AI SDK** - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒãƒ£ãƒƒãƒˆã€ãƒ„ãƒ¼ãƒ«ä½¿ç”¨
- **Google Gemini** - åˆ†æAIæ©Ÿèƒ½ï¼ˆè‡ªç„¶è¨€èªâ†’SQLå¤‰æ›ï¼‰
- **React Hot Toast** - ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥

### UI/ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°

- **Tailwind CSS 4** - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆCSS
- **Digital Agency Design System** - æ”¿åºœæ¨™æº–ã‚¢ã‚¯ã‚»ã‚·ãƒ–ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **HeroUI (NextUI)** - UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **Framer Motion** - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- **Font Awesome** - ã‚¢ã‚¤ã‚³ãƒ³
- **Leaflet / React Leaflet** - GISåœ°å›³è¡¨ç¤ºï¼ˆè©³ç´°ã¯ [GIS.md](GIS.md) å‚ç…§ï¼‰
- **Recharts** - ãƒãƒ£ãƒ¼ãƒˆãƒ»ã‚°ãƒ©ãƒ•
- **React Markdown** - Markdownè¡¨ç¤ºï¼ˆAIå¿œç­”ç”¨ï¼‰

### çŠ¶æ…‹ç®¡ç†/ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ

- **TanStack Query** - ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç®¡ç†ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã€ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- **Jotai** - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹ç®¡ç†ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«UIçŠ¶æ…‹ã€ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹ï¼‰
- **nuqs** - URL ã‚¯ã‚¨ãƒªçŠ¶æ…‹ç®¡ç†

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹/ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

- **Prisma** - ORMï¼ˆPostgreSQLï¼‰
- **Vercel Blob** - ç”»åƒã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

### é–‹ç™ºãƒ„ãƒ¼ãƒ«

- **Storybook 10** - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–‹ç™ºç’°å¢ƒ
- **ESLint 9** - é™çš„è§£æ
- **Prettier** - ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼
- **Stylelint** - ã‚¹ã‚¿ã‚¤ãƒ«æ¤œè¨¼
- **Husky + lint-staged** - Git ãƒ•ãƒƒã‚¯

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Presentation Layer              â”‚
â”‚  (src/app, src/features, src/hooks)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       Application Layer                 â”‚
â”‚  (src/server/application)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Domain Layer                    â”‚
â”‚  (src/server/domain)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Infrastructure Layer               â”‚
â”‚  (src/server/infrastructure)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. Presentation Layerï¼ˆãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼‰

#### `src/app/` - Next.js App Router

- ãƒšãƒ¼ã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®šç¾©
- Server Components
- Client Componentsï¼ˆ'use client'ï¼‰

#### `src/features/` - æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

å„æ©Ÿèƒ½ã”ã¨ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†å‰²ï¼š

- `actions.ts` - Server Actionsï¼ˆcreate, update, delete, getç­‰ï¼‰
- `components/` - æ©Ÿèƒ½å›ºæœ‰ã®UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `forms/` - Jotaiãƒ™ãƒ¼ã‚¹ã®ãƒ•ã‚©ãƒ¼ãƒ å®šç¾©
- `atoms/` - Jotai atomå®šç¾©ï¼ˆæ©Ÿèƒ½å›ºæœ‰ï¼‰
- `hooks/` - æ©Ÿèƒ½å›ºæœ‰ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
- `types/` - æ©Ÿèƒ½å›ºæœ‰ã®å‹å®šç¾©
- `utils/` - æ©Ÿèƒ½å›ºæœ‰ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

**ä¾‹ï¼š**

```
src/features/report/
â”œâ”€â”€ actions.ts              # Server Actions
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ReportDashboard.tsx
â”‚   â”œâ”€â”€ MapLegend.tsx       # åœ°å›³å‡¡ä¾‹ï¼ˆå…±é€šï¼‰
â”‚   â””â”€â”€ timeline/               # ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³é–¢é€£
â”‚       â”œâ”€â”€ TimelineLayer.tsx   # Leaflet.timelineãƒ¬ã‚¤ãƒ¤ãƒ¼
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ constants/              # animalMarkerConfigç­‰
â”œâ”€â”€ types/
â”‚   â””â”€â”€ timeline.ts         # ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç”¨å‹å®šç¾©
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ geoJsonConverter.ts # ReportDtoâ†’GeoJSONå¤‰æ›
â”‚   â””â”€â”€ clusterIconUtils.ts # ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ç”¨
â””â”€â”€ forms/
    â””â”€â”€ reportFormAtoms.ts

src/features/map/           # GISåœ°å›³æ©Ÿèƒ½ï¼ˆè©³ç´°ã¯ GIS.md å‚ç…§ï¼‰
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ FullscreenReportMap.tsx  # çµ±åˆåœ°å›³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ MapPage.tsx              # åœ°å›³ãƒšãƒ¼ã‚¸ï¼ˆiframeå¯¾å¿œï¼‰
â”‚   â””â”€â”€ MapLayerPanel.tsx        # ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‘ãƒãƒ«

src/features/line-verify/
â”œâ”€â”€ actions.ts              # AIç£å®³é€šå ±ç”¨Server Actions
â”œâ”€â”€ atoms/                  # ãƒãƒ£ãƒƒãƒˆçŠ¶æ…‹ç®¡ç†
â”œâ”€â”€ components/
â”‚   â””â”€â”€ chat/               # ãƒãƒ£ãƒƒãƒˆUI
â”œâ”€â”€ hooks/                  # ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ç”¨ãƒ•ãƒƒã‚¯
â”œâ”€â”€ types/                  # å‹å®šç¾©
â””â”€â”€ utils/                  # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

src/features/analysis/      # AIãƒ‡ãƒ¼ã‚¿åˆ†ææ©Ÿèƒ½
â”œâ”€â”€ atoms/                  # analysisAtoms.tsï¼ˆãƒãƒ£ãƒƒãƒˆçŠ¶æ…‹ï¼‰
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ chat/               # AnalysisChatContainer, AnalysisChatMessageListç­‰
â”‚   â”‚   â”œâ”€â”€ messages/       # BotTextBubble, BotTableBubble, UserQueryBubble
â”‚   â”‚   â””â”€â”€ shared/         # BotAvatar, TypingIndicator
â”‚   â””â”€â”€ results/            # DataTable.tsxï¼ˆSQLã‚¯ã‚¨ãƒªçµæœè¡¨ç¤ºï¼‰
â”œâ”€â”€ hooks/                  # useAnalysisChat.ts
â”œâ”€â”€ types/                  # AnalysisMessage, SqlQueryResult, ToolInvocation
â””â”€â”€ utils/                  # dataDictionary.tsï¼ˆã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰

src/features/dashboard/
â””â”€â”€ components/
    â”œâ”€â”€ StatisticsDashboard.tsx
    â”œâ”€â”€ BarChart.tsx
    â”œâ”€â”€ TrendChart.tsx
    â””â”€â”€ StatCard.tsx
```

**æ³¨**: GISï¼ˆåœ°å›³ï¼‰æ©Ÿèƒ½ã®è©³ç´°ã¯ [GIS.md](GIS.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### `src/hooks/` - ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯

- `mutations/` - TanStack Query Mutationãƒ•ãƒƒã‚¯
  - `useCreateReport.ts` - é€šå ±ä½œæˆ
  - `useUpdateReport.ts` - é€šå ±æ›´æ–°
  - `useDeleteReport.ts` - é€šå ±å‰Šé™¤
  - `useLineVerifyReport.ts` - LINEæ¤œè¨¼é€šå ±
  - `useReverseGeocode.ts` - é€†ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
- `forms/` - Jotaiãƒ™ãƒ¼ã‚¹ã®ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†ãƒ•ãƒƒã‚¯

#### `src/components/` - å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

- `ui/` - Digital Agency Design System ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `ui/Chat/` - çµ±åˆãƒãƒ£ãƒƒãƒˆUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  - `BotAvatar/` - ãƒœãƒƒãƒˆã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤º
  - `ChatBubble/` - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ–ãƒ«ï¼ˆãƒœãƒƒãƒˆ/ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰
  - `ChatContainer/` - ãƒãƒ£ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠ
  - `ChatMessageList/` - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰
  - `TypingIndicator/` - ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
  - `ScrollToBottomButton/` - æœ€ä¸‹éƒ¨ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³
  - `styles.ts` - å…±æœ‰ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©
- `layout/` - ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆAppLayout, Sidebar, SidebarNavItemï¼‰

### 2. Application Layerï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼‰

#### `src/server/application/`

**use-cases/report/** - ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å®Ÿè£…
ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼š

```typescript
// CreateReportUseCase.ts
class CreateReportUseCase {
  constructor(private repository: IReportRepository) {}

  async execute(dto: CreateReportDto): Promise<ReportDto> {
    const report = ReportMapper.fromCreateDto(dto);
    const saved = await this.repository.save(report);
    return ReportMapper.toDto(saved);
  }
}

export default CreateReportUseCase;
```

**å®Ÿè£…æ¸ˆã¿ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹:**

- `CreateReportUseCase.ts` - é€šå ±ä½œæˆ
- `UpdateReportUseCase.ts` - é€šå ±æ›´æ–°
- `DeleteReportUseCase.ts` - é€šå ±å‰Šé™¤
- `GetReportUseCase.ts` - é€šå ±å–å¾—
- `GetReportsUseCase.ts` - é€šå ±ä¸€è¦§å–å¾—
- `SearchReportsUseCase.ts` - é€šå ±æ¤œç´¢
- `FilterReportsByStatusUseCase.ts` - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ•ã‚£ãƒ«ã‚¿
- `FilterReportsByAnimalTypeUseCase.ts` - å‹•ç‰©ç¨®åˆ¥ã§ãƒ•ã‚£ãƒ«ã‚¿
- `GetReportStatisticsUseCase.ts` - çµ±è¨ˆæƒ…å ±å–å¾—

**dtos/** - Data Transfer Objects
ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã®ãƒ‡ãƒ¼ã‚¿è»¢é€ç”¨ï¼š

- `ReportDto.ts` - èª­ã¿å–ã‚Šç”¨DTO
- `CreateReportDto.ts` - ä½œæˆç”¨DTO
- `UpdateReportDto.ts` - æ›´æ–°ç”¨DTO
- `ReportStatisticsDto.ts` - çµ±è¨ˆç”¨DTO

### 3. Domain Layerï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼‰

#### `src/server/domain/`

**models/** - ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨ãƒ«ãƒ¼ãƒ«ã‚’ä¿æŒï¼š

```typescript
class Report {
  private constructor(private props: ReportProps) {
    this.validate();
  }

  static createNew(params: CreateParams): Report {
    // ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«æ¤œè¨¼
    if (!params.animalType) {
      throw new Error('å‹•ç‰©ç¨®åˆ¥ã¯å¿…é ˆã§ã™');
    }
    return new Report({...});
  }
}

export default Report;
```

**å®Ÿè£…æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«:**

- `Report.ts` - é€šå ±ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
- `ReportId.ts` - é€šå ±IDå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

**value-objects/** - å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
ä¸å¤‰ã®å€¤ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼š

- `Address.ts` - ä½æ‰€
- `AnimalType.ts` - å‹•ç‰©ç¨®åˆ¥ï¼ˆmonkey, deer, wild_boar, bear, otherï¼‰
- `DateRange.ts` - æ—¥ä»˜ç¯„å›²
- `Email.ts` - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æ¤œè¨¼
- `ImageUrl.ts` - ç”»åƒURL
- `ImageUrls.ts` - ç”»åƒURLé…åˆ—
- `Location.ts` - ç·¯åº¦çµŒåº¦
- `PhoneNumber.ts` - é›»è©±ç•ªå·æ¤œè¨¼
- `ReportStatus.ts` - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆwaiting, in_progress, completedï¼‰
- `Tag.ts` - ã‚¿ã‚°

**repositories/** - ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã®æŠ½è±¡åŒ–ï¼š

```typescript
export interface IReportRepository {
  save(report: Report): Promise<Report>;
  findById(id: ReportId): Promise<Report | null>;
  findAll(): Promise<Report[]>;
  delete(id: ReportId): Promise<void>;
  search(query: string): Promise<Report[]>;
  findByStatus(status: ReportStatus): Promise<Report[]>;
  findByAnimalType(animalType: AnimalType): Promise<Report[]>;
}
```

**services/** - ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹
è¤‡æ•°ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ã¾ãŸãŒã‚‹ãƒ­ã‚¸ãƒƒã‚¯ï¼š

- `SqlSecurityService.ts` - SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³é˜²æ­¢
- `StatisticsService.ts` - çµ±è¨ˆè¨ˆç®—

**constants/** - ãƒ‰ãƒ¡ã‚¤ãƒ³å®šæ•°

- `animalTypes.ts` - å‹•ç‰©ç¨®åˆ¥ã®å®šç¾©ï¼ˆãƒ©ãƒ™ãƒ«ã€è‰²ã€ãƒãƒ¼ã‚«ãƒ¼è¨­å®šï¼‰

### 4. Infrastructure Layerï¼ˆã‚¤ãƒ³ãƒ•ãƒ©å±¤ï¼‰

#### `src/server/infrastructure/`

**repositories/** - ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…

```typescript
// PrismaReportRepository.ts
class PrismaReportRepository implements IReportRepository {
  async save(report: Report): Promise<Report> {
    const data = ReportMapper.toPersistence(report);
    const saved = await prisma.report.upsert({
      where: { id: data.id },
      create: data,
      update: data,
    });
    return ReportMapper.toDomain(saved);
  }
}

export default PrismaReportRepository;
```

**å®Ÿè£…æ¸ˆã¿ãƒªãƒã‚¸ãƒˆãƒª:**

- `PrismaReportRepository.ts` - PostgreSQLçµŒç”±ã®Reportæ°¸ç¶šåŒ–
- `VercelBlobImageRepository.ts` - Vercel Blobã¸ã®ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- `SqlQueryExecutor.ts` - åˆ†ææ©Ÿèƒ½ç”¨SQLã‚¯ã‚¨ãƒªå®Ÿè¡Œ

**database/** - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š

- `prisma.ts` - Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

**mappers/** - ãƒ‡ãƒ¼ã‚¿å¤‰æ›

- `ReportMapper.ts` - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ« â†” DTO â†” Prismaãƒ¢ãƒ‡ãƒ«

**di/** - ä¾å­˜æ€§æ³¨å…¥

```typescript
class DIContainer {
  static getReportRepository(): IReportRepository {
    return new PrismaReportRepository();
  }
}

export default DIContainer;
```

**cache/** - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†

- `query-keys.ts` - TanStack Query ã‚­ãƒ¼ã®å‹å®‰å…¨å®šç¾©

**ai/** - AIçµ±åˆ

- `config/geminiConfig.ts` - Google Geminiãƒ¢ãƒ‡ãƒ«è¨­å®š
- `tools/runSqlTool.ts` - SQLå®Ÿè¡Œãƒ„ãƒ¼ãƒ«ï¼ˆåˆ†æAIç”¨ï¼‰

### 5. å…±é€šæ©Ÿèƒ½

#### `src/features/common/`

- `notifications/toast.ts` - ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ãƒ˜ãƒ«ãƒ‘ãƒ¼

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

```prisma
// prisma/schema.prisma
model Report {
  id                 String    @id @default(cuid())
  animalType         String    // enum: monkey, deer, wild_boar, bear, other
  latitude           Float
  longitude          Float
  address            String
  normalizedAddress  Json?     // æ­£è¦åŒ–ä½æ‰€ { prefecture, city, oaza, aza, detail, full, areaKey }
  phoneNumber        String?
  imageUrls          String[]  // PostgreSQL array type
  description        String?
  status             String    // enum: waiting, in_progress, completed
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  deletedAt          DateTime?

  @@index([deletedAt])
  @@index([status])
  @@index([animalType])
  @@map("reports")
}
```

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### ä½œæˆãƒ•ãƒ­ãƒ¼ï¼ˆCreateï¼‰

```
1. User Input
   â†“
2. Form Component (src/app/report/new/page.tsx)
   - FormDataä½œæˆ
   - useCreateReport() ãƒ•ãƒƒã‚¯å‘¼ã³å‡ºã—
   â†“
3. Mutation Hook (src/hooks/mutations/useCreateReport.ts)
   - useMutation ã§ãƒ©ãƒƒãƒ—
   - Server Actionå‘¼ã³å‡ºã—
   â†“
4. Server Action (src/features/report/actions.ts)
   - FormData â†’ CreateReportDto å¤‰æ›
   - Use Caseå®Ÿè¡Œ
   - revalidatePath() ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–
   â†“
5. Use Case (src/server/application/use-cases/report/CreateReportUseCase.ts)
   - DTO â†’ Domain Model å¤‰æ›ï¼ˆMapperçµŒç”±ï¼‰
   - Repositoryå‘¼ã³å‡ºã—
   â†“
6. Repository (src/server/infrastructure/repositories/PrismaReportRepository.ts)
   - PrismaçµŒç”±ã§PostgreSQLã«æ°¸ç¶šåŒ–
   â†“
7. Response
   - Domain Model â†’ DTO å¤‰æ›
   - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸è¿”å´
   â†“
8. Mutation Hook Success Handler
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ï¼ˆqueryClient.invalidateQueriesï¼‰
   - æˆåŠŸãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
   - ãƒšãƒ¼ã‚¸é·ç§»
```

## TanStack Query çµ±åˆ

### Mutation ãƒ•ãƒƒã‚¯æ§‹é€ 

```typescript
// src/hooks/mutations/useCreateReport.ts
export function useCreateReport() {
  const queryClient = useQueryClient();
  const router = useRouter();

  return useMutation({
    mutationFn: async (formData: FormData) => {
      return await createReport(formData);
    },
    onSuccess: (data: ReportDto) => {
      // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–
      queryClient.invalidateQueries({
        queryKey: queryKeys.reports.all,
      });

      // æˆåŠŸé€šçŸ¥
      showSuccessToast('é€šå ±ã‚’ç™»éŒ²ã—ã¾ã—ãŸ');

      // ãƒšãƒ¼ã‚¸é·ç§»
      router.push(`/report/${data.id}`);
    },
    onError: (error: Error) => {
      showErrorToast(error.message);
    },
  });
}
```

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç®¡ç†

```typescript
// src/server/infrastructure/cache/query-keys.ts
export const queryKeys = {
  reports: {
    all: ['reports'] as const,
    lists: () => [...queryKeys.reports.all, 'list'] as const,
    list: (filters?: Record<string, unknown>) =>
      [...queryKeys.reports.lists(), filters] as const,
    details: () => [...queryKeys.reports.all, 'detail'] as const,
    detail: (id: string) => [...queryKeys.reports.details(), id] as const,
    search: (query: string) =>
      [...queryKeys.reports.all, 'search', query] as const,
    filterByStatus: (status: string) =>
      [...queryKeys.reports.all, 'status', status] as const,
    filterByAnimalType: (animalType: string) =>
      [...queryKeys.reports.all, 'animalType', animalType] as const,
    statistics: () => [...queryKeys.reports.all, 'statistics'] as const,
  },
} as const;
```

## Jotai ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†

Jotaiã‚’ä½¿ç”¨ã—ãŸãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€‚ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å˜ä½ã®atomã§å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’æœ€é©åŒ–ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã€‚

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/
â”œâ”€â”€ hooks/forms/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ types.ts           # å‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ validation.ts      # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â””â”€â”€ createFormAtoms.ts # atomãƒ•ã‚¡ã‚¯ãƒˆãƒª
â”‚   â”œâ”€â”€ useJotaiForm.ts        # ãƒ•ã‚©ãƒ¼ãƒ å…¨ä½“ãƒ•ãƒƒã‚¯
â”‚   â””â”€â”€ useJotaiFormField.ts   # ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å˜ä½ãƒ•ãƒƒã‚¯
â””â”€â”€ features/
    â””â”€â”€ [feature]/forms/
        â””â”€â”€ [feature]FormAtoms.ts  # ãƒ•ã‚©ãƒ¼ãƒ å®šç¾©
```

### ãƒ•ã‚©ãƒ¼ãƒ å®šç¾©ã®ä½œæˆ

```typescript
// src/features/report/forms/reportFormAtoms.ts
import { createFormAtoms } from '@/hooks/forms/core/createFormAtoms';
import type { FormSchema, FormValues } from '@/hooks/forms/core/types';
import { rules } from '@/hooks/forms/core/validation';

// 1. ãƒ•ã‚©ãƒ¼ãƒ å€¤ã®å‹å®šç¾©ï¼ˆFormValuesã‚’ç¶™æ‰¿ï¼‰
export interface ReportFormValues extends FormValues {
  animalType: string;
  latitude: number;
  longitude: number;
  address: string;
  phoneNumber: string;
  description: string;
}

// 2. ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
const reportFormSchema: FormSchema<ReportFormValues> = {
  animalType: {
    name: 'animalType',
    defaultValue: '',
    rules: [rules.required('å‹•ç‰©ç¨®åˆ¥ã¯å¿…é ˆã§ã™')],
  },
  // ...
};

// 3. atomç¾¤ã‚’ç”Ÿæˆï¼ˆå‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šï¼‰
export const reportFormAtoms =
  createFormAtoms<ReportFormValues>(reportFormSchema);

// 4. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
export const reportValidationRules = {
  animalType: reportFormSchema.animalType.rules ?? [],
  // ...
};
```

### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«

```typescript
import { rules } from '@/hooks/forms/core/validation';

// çµ„ã¿è¾¼ã¿ãƒ«ãƒ¼ãƒ«
rules.required('å¿…é ˆé …ç›®ã§ã™');
rules.email('æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
rules.minLength(5, '5æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„');
rules.maxLength(100, '100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
rules.pattern(/^\d+$/, 'æ•°å­—ã®ã¿å…¥åŠ›ã—ã¦ãã ã•ã„');

// ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«
rules.custom((value) => value > 0, '0ã‚ˆã‚Šå¤§ãã„å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
```

### ãƒ•ã‚©ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã§ã®ä½¿ç”¨

```typescript
'use client';

import {
  reportFormAtoms,
  reportValidationRules,
  type ReportFormValues,
} from '@/features/report/forms/reportFormAtoms';
import useJotaiForm from '@/hooks/forms/useJotaiForm';
import useJotaiFormField from '@/hooks/forms/useJotaiFormField';

// ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–ï¼‰
function AnimalTypeField() {
  // å‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
  const { value, error, onChange } = useJotaiFormField<string>({
    fieldAtoms: reportFormAtoms.fields.animalType,
    rules: reportValidationRules.animalType,
    defaultValue: reportFormAtoms.initialValues.animalType,
  });

  return (
    <Select
      id="animalType"
      label="å‹•ç‰©ç¨®åˆ¥"
      value={value}
      onChange={onChange}
      error={error ?? undefined}
      required
    >
      <option value="monkey">ã‚µãƒ«</option>
      <option value="deer">ã‚·ã‚«</option>
      <option value="wild_boar">ã‚¤ãƒã‚·ã‚·</option>
      <option value="bear">ã‚¯ãƒ</option>
      <option value="other">ãã®ä»–</option>
    </Select>
  );
}

// ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
export default function NewReportPage() {
  const { mutate } = useCreateReport();

  // å‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
  const { errors, isValid, validateAll, getFormData } =
    useJotaiForm<ReportFormValues>(reportFormAtoms);

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (!validateAll()) return;
    mutate(getFormData()); // Server Actionsã¨äº’æ›
  };

  return (
    <form onSubmit={handleSubmit}>
      <AnimalTypeField />
      {/* ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */}
      <button type="submit" disabled={!isValid}>é€ä¿¡</button>
    </form>
  );
}
```

### useJotaiFormField ã®è¿”å´å€¤

| ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ | å‹                   | èª¬æ˜                                             |
| ---------- | -------------------- | ------------------------------------------------ |
| `value`    | `T`                  | ç¾åœ¨ã®å€¤                                         |
| `error`    | `string \| null`     | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸                                 |
| `touched`  | `boolean`            | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚¿ãƒƒãƒã•ã‚ŒãŸã‹                       |
| `onChange` | `(value: T) => void` | å€¤å¤‰æ›´ãƒãƒ³ãƒ‰ãƒ©ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰ |
| `onBlur`   | `() => void`         | ãƒ•ã‚©ãƒ¼ã‚«ã‚¹é›¢è„±ãƒãƒ³ãƒ‰ãƒ©                           |
| `validate` | `() => boolean`      | æ‰‹å‹•ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³                               |
| `reset`    | `() => void`         | åˆæœŸå€¤ã«ãƒªã‚»ãƒƒãƒˆ                                 |

### useJotaiForm ã®è¿”å´å€¤

| ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£      | å‹                                         | èª¬æ˜                         |
| --------------- | ------------------------------------------ | ---------------------------- |
| `values`        | `T`                                        | å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤             |
| `errors`        | `Partial<Record<keyof T, string \| null>>` | å…¨ã‚¨ãƒ©ãƒ¼                     |
| `isValid`       | `boolean`                                  | ãƒ•ã‚©ãƒ¼ãƒ å…¨ä½“ãŒæœ‰åŠ¹ã‹         |
| `isDirty`       | `boolean`                                  | åˆæœŸå€¤ã‹ã‚‰å¤‰æ›´ãŒã‚ã‚‹ã‹       |
| `reset`         | `() => void`                               | ãƒ•ã‚©ãƒ¼ãƒ å…¨ä½“ã‚’ãƒªã‚»ãƒƒãƒˆ       |
| `validateAll`   | `() => boolean`                            | å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |
| `getFormData`   | `() => FormData`                           | Server Actionsç”¨FormDataç”Ÿæˆ |
| `setFieldValue` | `(field, value) => void`                   | å€‹åˆ¥ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤è¨­å®š       |

### ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã§ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä½¿ç”¨

æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ç·¨é›†ã™ã‚‹ãƒšãƒ¼ã‚¸ã§ã¯ã€ãƒ•ã‚©ãƒ¼ãƒ å€¤ã‚’ãƒ­ãƒ¼ã‚«ãƒ«stateã§ç®¡ç†ã—ã¤ã¤ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ç›´æ¥ä½¿ç”¨ï¼š

```typescript
import { rules, validateField } from '@/hooks/forms/core/validation';

const [formData, setFormData] = useState({ animalType: '', description: '' });
const [errors, setErrors] = useState<Record<string, string | undefined>>({});

const validationRules = {
  animalType: [rules.required('å‹•ç‰©ç¨®åˆ¥ã¯å¿…é ˆã§ã™')],
  description: [rules.maxLength(1000, '1000æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„')],
};

const validate = () => {
  const newErrors: Record<string, string | undefined> = {};
  const animalError = validateField(
    formData.animalType,
    validationRules.animalType
  );
  const descError = validateField(
    formData.description,
    validationRules.description
  );
  if (animalError) newErrors.animalType = animalError;
  if (descError) newErrors.description = descError;
  setErrors(newErrors);
  return Object.keys(newErrors).length === 0;
};
```

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†

### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼

- **pnpm** ã‚’ä½¿ç”¨
- `pnpm install` ã§ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### ä¸»è¦ãªä¾å­˜é–¢ä¿‚

**ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³:**

- `next@16.1.1`
- `react@19.0.0`
- `@tanstack/react-query@^5.90.16`
- `jotai@^2.16.1` - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹ç®¡ç†
- `ai@^6.0.39` - Vercel AI SDK
- `@ai-sdk/google@^3.0.10` - Google Geminiçµ±åˆ
- `@ai-sdk/react@^3.0.41` - AIãƒ•ãƒƒã‚¯
- `@prisma/client@^6.19.1` - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ORM
- `@vercel/blob@^2.0.0` - ç”»åƒã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
- `react-hot-toast@^2.6.0`
- `@heroui/react@^2.4.6`
- `@digital-go-jp/design-tokens@^1.1.2`
- `leaflet@^1.9.4` / `react-leaflet@^5.0.0` - åœ°å›³è¡¨ç¤º
- `leaflet.heat@^0.2.0` - ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
- `leaflet.timeline@^1.6.0` - æ™‚ç³»åˆ—ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤º
- `recharts@^3.6.0` - ãƒãƒ£ãƒ¼ãƒˆ
- `nuqs@^2.8.6` - URLçŠ¶æ…‹ç®¡ç†
- `react-markdown@^10.1.0` - Markdownè¡¨ç¤º
- `zod@^4.3.5` - ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

**é–‹ç™º:**

- `typescript@^5`
- `eslint@^9`
- `prettier@^3.1.1`
- `storybook@^10.0.2`
- `prisma@^6.19.1` - Prisma CLI

## é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### é–‹ç™ºã‚³ãƒãƒ³ãƒ‰

**é–‹ç™ºã‚µãƒ¼ãƒãƒ¼:**

```bash
pnpm run dev        # Next.jsé–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹• (localhost:3000)
pnpm run build      # ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
pnpm run start      # ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ã‚¢ãƒ—ãƒªã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§èµ·å‹•
```

**ã‚³ãƒ¼ãƒ‰å“è³ª:**

```bash
pnpm run lint       # ESLintå®Ÿè¡Œ (--max-warnings=0)
npx prettier --write "src/**/*.{js,jsx,ts,tsx,json}"  # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
npx stylelint "src/**/*.{css,scss,sass}"              # ã‚¹ã‚¿ã‚¤ãƒ«æ¤œè¨¼
```

**Storybook:**

```bash
pnpm run storybook        # Storybookèµ·å‹• (localhost:6006)
pnpm run build-storybook  # é™çš„Storybookãƒ“ãƒ«ãƒ‰
```

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹:**

```bash
pnpm run db:generate  # Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆ
pnpm run db:push      # ã‚¹ã‚­ãƒ¼ãƒã‚’DBã«ãƒ—ãƒƒã‚·ãƒ¥
pnpm run db:studio    # Prisma Studioèµ·å‹•
```

### æ–°æ©Ÿèƒ½ã®è¿½åŠ æ‰‹é †

**1. ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã‹ã‚‰å®Ÿè£…é–‹å§‹**

- `src/server/domain/models/` ã«ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ä½œæˆ
- `src/server/domain/value-objects/` ã«å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
- `src/server/domain/repositories/` ã«ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©

**2. ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®å®Ÿè£…**

- `prisma/schema.prisma` ã«ãƒ¢ãƒ‡ãƒ«å®šç¾©è¿½åŠ 
- `pnpm run db:generate` ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ›´æ–°
- `src/server/infrastructure/repositories/` ã«Prismaãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…
- `src/server/infrastructure/mappers/` ã«Mapperä½œæˆ

**3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤**

- `src/server/application/dtos/` ã«DTOä½œæˆ
- `src/server/application/use-cases/[feature]/` ã«Use Caseå®Ÿè£…

**4. ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤**

- `src/features/[feature]/actions.ts` ã«Server Actionsä½œæˆ
- `src/hooks/mutations/use[Feature]Mutations.ts` ã«Mutationãƒ•ãƒƒã‚¯ä½œæˆ
- `src/app/[feature]/` ã«ãƒšãƒ¼ã‚¸ä½œæˆ
- `src/features/[feature]/components/` ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ

### React Hooks ä½¿ç”¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

**åŸå‰‡: æœ€å°é™ã®hooksä½¿ç”¨**

ä¸è¦ãªuseState/useEffect/useRefã¯ã‚³ãƒ¼ãƒ‰ã®è¤‡é›‘æ€§ã‚’å¢—ã—ã€ãƒã‚°ã®åŸå› ã«ãªã‚‹ã€‚ä»¥ä¸‹ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«å¾“ã£ã¦æœ€å°é™ã«æŠ‘ãˆã‚‹ã€‚

#### useState ã‚’ä½¿ã‚ãªã„ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// âŒ æ‚ªã„ä¾‹: TanStack Queryã®çŠ¶æ…‹ã‚’åˆ¥é€”ç®¡ç†
const [isSaving, setIsSaving] = useState(false);
const mutation = useUpdateReport();
// setIsSaving(true) â†’ mutation.mutate() â†’ setIsSaving(false)

// âœ… è‰¯ã„ä¾‹: mutation.isPendingã‚’ç›´æ¥ä½¿ç”¨
const mutation = useUpdateReport();
<Button disabled={mutation.isPending}>
  {mutation.isPending ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'}
</Button>
```

```typescript
// âŒ æ‚ªã„ä¾‹: URLã«æ°¸ç¶šåŒ–ã™ã¹ãçŠ¶æ…‹ã‚’useStateã§ç®¡ç†
const [isFilterOpen, setIsFilterOpen] = useState(false);
const [sortOrder, setSortOrder] = useState('asc');

// âœ… è‰¯ã„ä¾‹: nuqsã§URLçŠ¶æ…‹ç®¡ç†ï¼ˆãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯å¯èƒ½ï¼‰
const [params, setParams] = useQueryStates({
  filter: parseAsBoolean.withDefault(false),
  sort: parseAsStringLiteral(['asc', 'desc']).withDefault('asc'),
});
```

```typescript
// âŒ æ‚ªã„ä¾‹: ä»–ã®çŠ¶æ…‹ã‹ã‚‰è¨ˆç®—å¯èƒ½ãªæ´¾ç”ŸçŠ¶æ…‹
const [messages, setMessages] = useState([]);
const [isChatStarted, setIsChatStarted] = useState(false);
// messagesãŒå¤‰ã‚ã‚‹ãŸã³ã«isChatStartedã‚‚æ›´æ–°ãŒå¿…è¦

// âœ… è‰¯ã„ä¾‹: æ´¾ç”Ÿå€¤ã¨ã—ã¦ç›´æ¥è¨ˆç®—
const isChatStarted = messages.length > 0;
```

#### useEffect ã‚’ä½¿ã‚ãªã„ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// âŒ æ‚ªã„ä¾‹: çŠ¶æ…‹åŒæœŸã®ãŸã‚ã®useEffect
useEffect(() => {
  if (messages.length > 0) {
    setIsChatStarted(true);
  }
}, [messages.length]);

// âœ… è‰¯ã„ä¾‹: æ´¾ç”Ÿå€¤ã¨ã—ã¦è¨ˆç®—ï¼ˆuseEffectä¸è¦ï¼‰
const isChatStarted = messages.length > 0;
```

#### useRef ã‚’ä½¿ã‚ãªã„ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// âŒ æ‚ªã„ä¾‹: å¤–å´ã‚¯ãƒªãƒƒã‚¯æ¤œå‡ºã«useRef + useEffect
const menuRef = useRef(null);
useEffect(() => {
  const handleClick = (e) => {
    if (menuRef.current && !menuRef.current.contains(e.target)) {
      setIsOpen(false);
    }
  };
  document.addEventListener('mousedown', handleClick);
  return () => document.removeEventListener('mousedown', handleClick);
}, []);

// âœ… è‰¯ã„ä¾‹: é€æ˜ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã§ã‚¯ãƒªãƒƒã‚¯æ¤œå‡º
{isOpen && (
  <>
    <div className="fixed inset-0" onClick={() => setIsOpen(false)} />
    <Menu />
  </>
)}
```

#### æ­£å½“ãªuseRef/useEffectã®ä½¿ç”¨ä¾‹

ä»¥ä¸‹ã®å ´åˆã¯useRef/useEffectãŒå¿…è¦ï¼š

- **ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã®ã‚¯ãƒªãƒƒã‚¯å‘¼ã³å‡ºã—**: `inputRef.current.click()`
- **ãƒ€ã‚¤ã‚¢ãƒ­ã‚°åˆ¶å¾¡**: `dialogRef.current.showModal()` / `.close()`
- **å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªçµ±åˆ**: Leaflet, Chart.jsç­‰ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç®¡ç†
- **ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡**: `element.scrollIntoView()`
- **ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†**: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

#### çŠ¶æ…‹ç®¡ç†ã®é¸æŠåŸºæº–

| çŠ¶æ…‹ã®ç¨®é¡           | æ¨å¥¨ãƒ„ãƒ¼ãƒ«                      |
| -------------------- | ------------------------------- |
| ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿       | TanStack Query                  |
| ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ | `mutation.isPending` ã‚’ç›´æ¥å‚ç…§ |
| URLæ°¸ç¶šåŒ–ãŒå¿…è¦      | nuqs                            |
| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“å…±æœ‰ | Jotai atom                      |
| ãƒ­ãƒ¼ã‚«ãƒ«UIçŠ¶æ…‹ã®ã¿   | useStateï¼ˆæœ€çµ‚æ‰‹æ®µï¼‰            |

#### ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†ï¼ˆJotai atomsï¼‰

ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã®çŠ¶æ…‹ã¯ `useState` ã§ã¯ãªã **Jotai atoms** ã§ç®¡ç†ã™ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚ŠåˆæœŸå€¤ã®å•é¡Œï¼ˆuseStateã¯åˆå›ãƒã‚¦ãƒ³ãƒˆæ™‚ã®ã¿è©•ä¾¡ï¼‰ã‚’å›é¿ã—ã€ä¸€è²«ã—ãŸçŠ¶æ…‹ç®¡ç†ãŒå¯èƒ½ã«ãªã‚‹ã€‚

**atomãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®:**

```
src/features/[feature]/atoms/[feature]EditAtoms.ts
```

**atomå®šç¾©ã®ä¾‹:**

```typescript
// src/features/report/atoms/reportEditAtoms.ts
import { atom } from 'jotai';
import type { ReportDto } from '@/server/application/dtos/ReportDto';

// å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å€‹åˆ¥ã®atomã§ç®¡ç†
export const editingReportIdAtom = atom<string | null>(null);
export const animalTypeAtom = atom<string>('');
export const addressAtom = atom<string>('');
export const statusAtom = atom<string>('waiting');
// ... ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

// ã‚¢ã‚¯ã‚·ãƒ§ãƒ³atom: ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ•ã‚©ãƒ¼ãƒ ã‚’åˆæœŸåŒ–
export const initFormFromReportAtom = atom(
  null,
  (get, set, report: ReportDto) => {
    set(editingReportIdAtom, report.id);
    set(animalTypeAtom, report.animalType);
    set(addressAtom, report.address);
    set(statusAtom, report.status);
    // ... ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  }
);

// ã‚¢ã‚¯ã‚·ãƒ§ãƒ³atom: ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
export const resetFormAtom = atom(null, (get, set) => {
  set(editingReportIdAtom, null);
  set(animalTypeAtom, '');
  set(addressAtom, '');
  set(statusAtom, 'waiting');
  // ... ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
});
```

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®ä½¿ç”¨:**

```typescript
// å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’useAtomã§å–å¾—
const [animalType, setAnimalType] = useAtom(animalTypeAtom);
const [status, setStatus] = useAtom(statusAtom);
const initFormFromReport = useSetAtom(initFormFromReportAtom);
const resetForm = useSetAtom(resetFormAtom);

// ç·¨é›†ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚: æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã§atomã‚’åˆæœŸåŒ–
<Button onClick={() => {
  initFormFromReport(report);  // â† SSRã§å–å¾—ã—ãŸæœ€æ–°ãƒ‡ãƒ¼ã‚¿
  setIsEditing(true);
}}>
  ç·¨é›†
</Button>

// ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚: atomã‚’ãƒªã‚»ãƒƒãƒˆ
<Button onClick={() => {
  resetForm();
  setIsEditing(false);
}}>
  ã‚­ãƒ£ãƒ³ã‚»ãƒ«
</Button>
```

**åˆ©ç‚¹:**

- `useState` ã®åˆæœŸå€¤å•é¡Œã‚’å›é¿ï¼ˆuseStateã¯åˆå›ãƒã‚¦ãƒ³ãƒˆæ™‚ã®ã¿è©•ä¾¡ã•ã‚Œã‚‹ï¼‰
- ç·¨é›†ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã«æœ€æ–°ã®propsã§ãƒ•ã‚©ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã§ãã‚‹
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ãªã©ä»–ã®æ“ä½œã¨ä¸€è²«ã—ãŸçŠ¶æ…‹ç®¡ç†
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å˜ä½ã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

**å‘½åè¦å‰‡:**

- **ãƒ•ã‚¡ã‚¤ãƒ«å**:
  - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ/ã‚¯ãƒ©ã‚¹: PascalCase (`Button.tsx`, `UserService.ts`)
  - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: kebab-case (`tailwind.config.ts`)
  - Storybookã‚¹ãƒˆãƒ¼ãƒªãƒ¼: `Component.stories.ts`
  - ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: `Component.test.tsx`
- **å¤‰æ•°/é–¢æ•°**: camelCase
- **ã‚¯ãƒ©ã‚¹/å‹**: PascalCase
- **å®šæ•°**: UPPER_SNAKE_CASE

**ã‚¤ãƒ³ãƒãƒ¼ãƒˆé †åº** (eslint-plugin-simple-import-sort):

1. React/Next.js
2. å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
3. å†…éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ@/...ï¼‰
4. ç›¸å¯¾ãƒ‘ã‚¹

**ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ«ãƒ¼ãƒ«:**

- **ãƒãƒ¬ãƒ«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆindex.tsï¼‰ã¯ä½¿ç”¨ç¦æ­¢** - ç›´æ¥ãƒ‘ã‚¹ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ã™ã‚‹
- **ã‚¯ãƒ©ã‚¹**: default exportã‚’ä½¿ç”¨
- **å‹/ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: named exportã‚’ä½¿ç”¨
- **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°/å®šæ•°**: named exportã‚’ä½¿ç”¨

```typescript
// âœ… æ­£ã—ã„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import Button from '@/components/ui/Button/Button';
import CreateReportUseCase from '@/server/application/use-cases/report/CreateReportUseCase';
import type { ReportDto } from '@/server/application/dtos/ReportDto';
import { buttonBaseStyle } from '@/components/ui/Button/Button';

// âŒ ç¦æ­¢: ãƒãƒ¬ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import { Button, Input } from '@/components/ui';
import { CreateReportUseCase } from '@/server/application/use-cases/report';
import type { ReportDto } from '@/server/application/dtos';
```

**ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³:**

```typescript
// ã‚¯ãƒ©ã‚¹ï¼ˆUseCase, Repository, Mapper, Model, ValueObjectï¼‰
class CreateReportUseCase {
  // ...
}
export default CreateReportUseCase;

// å‹/ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆDTOç­‰ï¼‰
export interface ReportDto {
  // ...
}

// ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆåŒãƒ•ã‚¡ã‚¤ãƒ«å†…ã§named exportï¼‰
export const buttonBaseStyle = '...';
const Button = forwardRef<...>(...);
export default Button;
```

**å‹å®šç¾©:**

- `interface` ã‚’å„ªå…ˆï¼ˆæ‹¡å¼µæ€§ã®ãŸã‚ï¼‰
- `type` ã¯Union/Intersectionã§ä½¿ç”¨

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ:**

```
src/components/ui/Button/
â”œâ”€â”€ Button.tsx           # å®Ÿè£…
â”œâ”€â”€ Button.module.scss   # ã‚¹ã‚¿ã‚¤ãƒ« (SCSS modules)
â””â”€â”€ Button.stories.ts    # Storybook
```

**ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°:**

- Tailwind CSSã‚’å„ªå…ˆ
- è¤‡é›‘ãªã‚¹ã‚¿ã‚¤ãƒ«ã¯SCSS modulesã‚’ä½¿ç”¨
- ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«ã¯ `src/app/globals.css`
- `.editorconfig` ã§2ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã€LFæ”¹è¡Œã‚’å¼·åˆ¶

### æ¤œç´¢æ¡ä»¶UIã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

é€šå ±ä¸€è¦§ãƒšãƒ¼ã‚¸ï¼ˆ`/report`ï¼‰ã®æ¤œç´¢æ¡ä»¶UIã¯ã€ç¾åœ¨ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ç¶­æŒã™ã‚‹ã“ã¨ã€‚

**ãƒ¡ã‚¤ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ¼ï¼ˆå¸¸æ™‚è¡¨ç¤ºï¼‰:**

- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- ç£ç¨®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- è©³ç´°ãƒœã‚¿ãƒ³
- è¡¨ç¤ºå½¢å¼åˆ‡ã‚Šæ›¿ãˆï¼ˆãƒªã‚¹ãƒˆ/åœ°å›³ï¼‰

**è©³ç´°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆå±•é–‹å¼ï¼‰:**

- æœŸé–“ï¼ˆDateRangePickerï¼‰
- ä¸¦ã³é †
- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤ºãƒˆã‚°ãƒ«ï¼ˆåœ°å›³ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿ï¼‰
- æ¨å®šè¡¨ç¤ºæœŸé–“ï¼ˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚ªãƒ³æ™‚ã®ã¿ï¼‰

**æ–°ã—ã„æ¤œç´¢æ¡ä»¶ã‚’è¿½åŠ ã™ã‚‹å ´åˆ:**

- ãƒ¡ã‚¤ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ¼ã«ã¯è¿½åŠ ã—ãªã„ï¼ˆç¾åœ¨ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ç¶­æŒï¼‰
- è©³ç´°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å†…ã«è¿½åŠ ã™ã‚‹
- ç‰¹å®šã®viewModeã§ã®ã¿å¿…è¦ãªè¨­å®šã¯ã€ãã®ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿è¡¨ç¤ºã™ã‚‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ğŸ” æ¤œç´¢] [ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ â–¼] [ç£ç¨® â–¼] [è©³ç´° â–¼] [ãƒªã‚¹ãƒˆ|åœ°å›³]       â”‚  â† å›ºå®š
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœŸé–“: [DateRangePicker]          ä¸¦ã³é †: [â–¼]                    â”‚  â† è©³ç´°å†…
â”‚ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤º: [â—‹ ã‚ªãƒ•]       æ¨å®šè¡¨ç¤ºæœŸé–“: [7æ—¥é–“ â–¼]        â”‚  â† è©³ç´°å†…ï¼ˆåœ°å›³æ™‚ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

**ç¾çŠ¶:**

- è‡ªå‹•ãƒ†ã‚¹ãƒˆã¯æœªå®Ÿè£…
- Storybookã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã¨æ‰‹å‹•ç¢ºèªã§å“è³ªæ‹…ä¿

**å°†æ¥ã®å®Ÿè£…è¨ˆç”»:**

- **å˜ä½“ãƒ†ã‚¹ãƒˆ**: Domain Models, Value Objects, Use Cases
  - ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®: `Component.test.tsx`ï¼ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
  - ãƒ„ãƒ¼ãƒ«: React Testing Library
- **çµ±åˆãƒ†ã‚¹ãƒˆ**: Server Actions, Repository
- **E2Eãƒ†ã‚¹ãƒˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼

**ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã®ãƒã‚§ãƒƒã‚¯:**

```bash
npx lint-staged  # Huskyãƒ•ãƒƒã‚¯ã‚’æ‰‹å‹•å®Ÿè¡Œ
pnpm run build   # ãƒ“ãƒ«ãƒ‰æˆåŠŸã‚’ç¢ºèª
```

**å‹•ä½œç¢ºèª**
localhost:3000ã§æ‰‹å‹•ç¢ºèª(æ—¢ã«3000ãƒãƒ¼ãƒˆãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãã‚Œã‚’æµç”¨)
playwright-mcpã§å‹•ä½œç¢ºèªã™ã‚‹ã€‚ç”»åƒã¯.playwright-mcpãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã™ã‚‹ã€‚
â€»å‹•ä½œç¢ºèªæ™‚ã¯ `pnpm run build` ã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰ç¢ºèªã¯ä¸è¦ï¼ˆé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã§ã®ç¢ºèªã§ååˆ†ï¼‰

### Git ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

**ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** (Conventional Commits):

```
feat: æ–°æ©Ÿèƒ½è¿½åŠ 
fix: ãƒã‚°ä¿®æ­£
chore(deps): ä¾å­˜é–¢ä¿‚æ›´æ–°
refactor: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
docs: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
style: ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
test: ãƒ†ã‚¹ãƒˆè¿½åŠ /ä¿®æ­£
```

**ä¾‹:**

```
feat: Add report statistics dashboard
fix: Resolve map marker display issue
chore(deps): Update @tanstack/react-query to v5.90.16
```

**é‡è¦:** Co-Authored-Byè¡Œã¯ä½¿ç”¨ã—ãªã„ã€‚ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ä¿ã¤ã“ã¨ã€‚

**Pull Request ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³:**

1. é–¢é€£ã™ã‚‹å¤‰æ›´ã‚’1ã¤ã®PRã«ã¾ã¨ã‚ã‚‹
2. ç°¡æ½”ãªèª¬æ˜ã¨ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ/å‹•ç”»ã‚’æ·»ä»˜ï¼ˆUIå¤‰æ›´æ™‚ï¼‰
3. PRãƒãƒ¼ã‚¸å‰ã«ä»¥ä¸‹ã‚’ç¢ºèª:
   - `pnpm run lint` ãŒæˆåŠŸ
   - `pnpm run build` ãŒæˆåŠŸ
   - Storybookã§å‹•ä½œç¢ºèª

**Huskyãƒ•ãƒƒã‚¯:**

- `pre-commit`: lint-stagedå®Ÿè¡Œï¼ˆESLintã€Stylelintã€Prettierï¼‰
- ãƒã‚¤ãƒ‘ã‚¹ã¯é¿ã‘ã‚‹ï¼ˆCIå¤±æ•—ã®åŸå› ã«ãªã‚‹ï¼‰

**CI/CDè¦ä»¶:**

- Node.js 24.11.0 (`.node-version` å‚ç…§)
- ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‚‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³çµ±ä¸€ï¼ˆnvm/fnmä½¿ç”¨æ¨å¥¨ï¼‰
- Renovateã§ä¾å­˜é–¢ä¿‚è‡ªå‹•æ›´æ–°ï¼ˆå¤§è¦æ¨¡ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã¯æ…é‡ã«ï¼‰

## ã‚ˆãã‚ã‚‹è³ªå•

### Q: src/lib ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ï¼Ÿ

A: å»ƒæ­¢ã•ã‚Œã¾ã—ãŸã€‚ä»£ã‚ã‚Šã«ä»¥ä¸‹ã‚’ä½¿ç”¨ï¼š

- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç† â†’ `src/server/infrastructure/cache/`
- é€šçŸ¥æ©Ÿèƒ½ â†’ `src/features/common/notifications/`

### Q: InMemoryRepositoryã¯ã©ã“ã«ï¼Ÿ

A: Prismaãƒªãƒã‚¸ãƒˆãƒªã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸã€‚`src/server/infrastructure/repositories/PrismaReportRepository.ts` ã‚’ä½¿ç”¨ã€‚

### Q: Server Actions ã¨ API Routes ã®ä½¿ã„åˆ†ã‘ã¯ï¼Ÿ

A: Server Actions ã‚’å„ªå…ˆã€‚å¤–éƒ¨APIã‚„Webhookå—ä¿¡ã«ã¯ API Routes ã‚’ä½¿ç”¨ã€‚

### Q: Jotai ã¨ TanStack Query ã®ä½¿ã„åˆ†ã‘ã¯ï¼Ÿ

A:

- Jotai: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«é–‹é–‰ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çŠ¶æ…‹ã€ãƒ†ãƒ¼ãƒç­‰ã®UIçŠ¶æ…‹ã€ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹ï¼‰
- TanStack Query: ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ï¼ˆãƒ‡ãƒ¼ã‚¿å–å¾—ã€ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ï¼‰

### Q: ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å…ˆã¯ï¼Ÿ

A: Vercel Blobã‚’ä½¿ç”¨ã€‚`VercelBlobImageRepository` ã§ç®¡ç†ã€‚

### Q: åœ°å›³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½¿ã„æ–¹ã¯ï¼Ÿ

A: GISï¼ˆåœ°å›³ï¼‰æ©Ÿèƒ½ã®è©³ç´°ã¯ **[GIS.md](GIS.md)** ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**æ¦‚è¦:**

- çµ±åˆåœ°å›³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ `FullscreenReportMap` ã‚’ä½¿ç”¨
- è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰: fullscreen / embedded
- åœ°å›³ãƒ¢ãƒ¼ãƒ‰: defaultï¼ˆé€šå¸¸ï¼‰ / timelineï¼ˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼‰
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³: popup / click / none
- iframeåŸ‹ã‚è¾¼ã¿å¯¾å¿œï¼ˆ`/map/embed`ï¼‰

**ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ:**

```tsx
<FullscreenReportMap
  reports={reports}
  displayMode="embedded"
  mapMode="default"
  interactionMode="click"
  showLegend={true}
/>
```

è©³ç´°ãªä½¿ç”¨ä¾‹ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€è¨­å®šã«ã¤ã„ã¦ã¯ [GIS.md](GIS.md) ã‚’ã”è¦§ãã ã•ã„ã€‚

### Q: åˆ†æAIæ©Ÿèƒ½ã®ä»•çµ„ã¿ã¯ï¼Ÿ

A: Vercel AI SDK + Google Gemini ã‚’ä½¿ç”¨ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªç„¶è¨€èªã‚¯ã‚¨ãƒªã‚’SQLã«å¤‰æ›ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ¤œç´¢ã—ã¦çµæœã‚’è¿”ã—ã¾ã™ã€‚

- ãƒãƒ£ãƒƒãƒˆUI: `src/features/analysis/components/chat/`
- AIãƒ„ãƒ¼ãƒ«: `src/server/infrastructure/ai/tools/runSqlTool.ts`
- APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `src/app/api/analysis/chat/route.ts`

### Q: ãƒãƒ£ãƒƒãƒˆUIã®å…±æœ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ï¼Ÿ

A: `src/components/ui/Chat/` ã«çµ±åˆã•ã‚Œã¦ã„ã¾ã™ã€‚line-verify ã¨ analysis ã§å…±é€šåˆ©ç”¨ã€‚

## ãƒªã‚½ãƒ¼ã‚¹

- [Next.js 16 Docs](https://nextjs.org/docs)
- [TanStack Query](https://tanstack.com/query/latest)
- [Prisma Docs](https://www.prisma.io/docs)
- [Digital Agency Design System](https://www.digital.go.jp/policies/servicedesign/designsystem)
- [Vercel AI SDK](https://sdk.vercel.ai/docs)
- [Google Gemini](https://ai.google.dev/docs)
- [DDDå‚è€ƒè³‡æ–™](https://github.com/domain-driven-design)
- **[GISæ©Ÿèƒ½ã‚¬ã‚¤ãƒ‰](GIS.md)** - åœ°å›³æ©Ÿèƒ½ã®è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
